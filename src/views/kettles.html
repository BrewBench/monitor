<div class="kettles col-md-{{kettles.length==5?2:12/kettles.length}}" ng-repeat="kettle in kettles track by $index" id="kettle{{$index}}">

  <div class="panel panel-default">
    <div class="panel-heading container-fluid">

      <div class="kettle-row">
        <div class="kettle-head">
          <img class="type" ng-src="/assets/img/{{kettle.type}}.svg" height="30" ng-click="changeKettleType(kettle)"/>
          <h3><editable type="text" model="kettle.key"></editable></h3>
        </div>
        <div>
          <i class="fa fa-4x" ng-click="startStopKettle(kettle)" ng-class="{'fa-stop-circle':kettle.active,'fa-play-circle':!kettle.active}"></i>
        </div>
      </div>

      <div class="kettle-row" ng-if="!settings.shared">
        <div class="kettle-col">
          <label class="adjust">Temp</label>
          <div class="btn-group">
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                {{sensorTypes(kettle.temp.type).analog ? 'A' : 'D'}}{{kettle.temp.pin}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" ng-if="sensorTypes(kettle.temp.type).analog">
                <li ng-repeat="p in getPortRange(settings.ports.analog) track by $index" ng-class="{'active': kettle.temp.pin==p}">
                  <a href="#" ng-click="pinChange(kettle.temp.pin,p,true); kettle.temp.pin=p;">A{{p}}
                    <span class="pininuse" ng-show="pinInUse(p,true)">(In Use)</span>
                  </a>
                </li>
              </ul>
              <ul class="dropdown-menu" ng-if="!sensorTypes(kettle.temp.type).analog">
                <li ng-repeat="p in getPortRange(settings.ports.digital) track by $index" ng-class="{'active': kettle.temp.pin==p}">
                  <a href="#" ng-click="pinChange(kettle.temp.pin,p,false); kettle.temp.pin=p;">D{{p}}
                    <span class="pininuse" ng-show="pinInUse(p,false)">(In Use)</span>
                  </a>
                </li>
              </ul>
            </div>
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                {{kettle.temp.type}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" ng-init="sensors = sensorTypes()">
                <li ng-repeat="s in sensors track by $index" ng-class="{'active': kettle.temp.type==s.name}">
                  <a href="#" ng-click="kettle.temp.type=s.name;">{{s.name}}</a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="kettle-col">
          <label class="adjust" ng-class="{'heating':kettle.heater.running}">Heat</label>
          <div class="btn-group">
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                D{{kettle.heater.pin}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li ng-repeat="p in getPortRange(settings.ports.digital) track by $index" ng-class="{'active': kettle.heater.pin==p}">
                  <a href="#" ng-click="pinChange(kettle.heater.pin,p,false); kettle.heater.pin=p;">D{{p}} <span class="pininuse" ng-show="pinInUse(p,false)">(In Use)</span></a>
                </li>
              </ul>
            </div>
            <div class="btn-group relay">
              <button type="button" class="btn" ng-class="{'btn-default':!kettle.heater.running&&!kettle.heater.auto,'btn-success':kettle.heater.running,'btn-warning':!kettle.heater.running&&kettle.heater.auto}" ng-click="toggleKettle('heat',kettle)">{{kettle.heater.running ? 'On' : (kettle.heater.auto ? 'Wait' :'Off')}}</button>
              <button type="button" class="btn" ng-class="{'btn-default':!kettle.heater.auto,'btn-success':kettle.heater.auto}" ng-click="kettle.heater.auto=!kettle.heater.auto">Auto</button>
            </div>
          </div>
        </div>

        <div class="kettle-col" ng-if="kettle.type !== 'fermenter'">
          <label class="adjust">Pump</label>
          <div class="btn-group">
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                D{{kettle.pump.pin}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li ng-repeat="p in getPortRange(settings.ports.digital) track by $index" ng-class="{'active': kettle.pump.pin==p}">
                  <a href="#" ng-click="pinChange(kettle.pump.pin,p,false); kettle.pump.pin=p;">D{{p}} <span class="pininuse" ng-show="pinInUse(p,false)">(In Use)</span></a>
                </li>
              </ul>
            </div>
            <div class="btn-group relay">
              <button type="button" class="btn" ng-class="{'btn-default':!kettle.pump.running&&!kettle.pump.auto,'btn-success':kettle.pump.running,'btn-warning':!kettle.pump.running&&kettle.pump.auto}" ng-click="toggleKettle('heat',kettle)">{{kettle.pump.running ? 'On' : (kettle.pump.auto ? 'Wait' :'Off')}}</button>
              <button type="button" class="btn" ng-class="{'btn-default':!kettle.pump.auto,'btn-success':kettle.pump.auto}" ng-click="kettle.pump.auto=!kettle.pump.auto">Auto</button>
            </div>
          </div>
        </div>

        <div class="kettle-col" ng-if="kettle.type === 'fermenter' && kettle.cooler">
          <label class="adjust" ng-class="{'cooling':kettle.cooler.running}">Cool</label>
          <div class="btn-group">
            <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                D{{kettle.cooler.pin}} <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li ng-repeat="p in getPortRange(settings.ports.digital) track by $index" ng-class="{'active': kettle.cooler.pin==p}">
                  <a href="#" ng-click="pinChange(kettle.cooler.pin,p,false); kettle.cooler.pin=p;">D{{p}} <span class="pininuse" ng-show="pinInUse(p,false)">(In Use)</span></a>
                </li>
              </ul>
            </div>
            <div class="btn-group relay">
              <button type="button" class="btn" ng-class="{'btn-default':!kettle.cooler.running&&!kettle.cooler.auto,'btn-success':kettle.cooler.running,'btn-warning':!kettle.cooler.running&&kettle.cooler.auto}" ng-click="toggleKettle('cool',kettle)">{{kettle.cooler.running ? 'On' : (kettle.cooler.auto ? 'Wait' :'Off')}}</button>
              <button type="button" class="btn" ng-class="{'btn-default':!kettle.cooler.auto,'btn-success':kettle.cooler.auto}" ng-click="kettle.cooler.auto=!kettle.cooler.auto">Auto</button>
            </div>
          </div>
        </div>

      </div>

    </div>

    <div class="panel-body container-fluid">
      <div class="kettle-row" ng-class="{'text-center': settings.shared}">
        <div class="kettle-col">
          <ui-knob value="kettle.temp.current" options="kettle.knob" ng-click="knobClick(kettle)"></ui-knob>
          <div class="adjusted" ng-if="kettle.temp.adjust != 0" ng-click="kettle.temp.adjust=0;kettle.temp.current=kettle.temp.previous;">adjusted {{kettle.temp.adjust}}&deg;</div>
        </div>
        <div class="kettle-col" ng-if="!settings.shared">
            <div class="btn-group pull-right" role="group">
              <label class="adjust">Target</label>
              <button type="button" class="btn btn-default" style="width:62px;"><editable type="number" model="kettle.temp.target">{{kettle.temp.target}}</editable>&deg;{{settings.unit}}</button>
              <button type="button" class="btn btn-default" ng-click="changeValue(kettle,'target',false)"><i class="fa fa-minus fa-lg"></i></button>
              <button type="button" class="btn btn-default" ng-click="changeValue(kettle,'target',true)"><i class="fa fa-plus fa-lg"></i></button>
            </div>
            <div class="btn-group pull-right" role="group">
              <label class="adjust">Diff</label>
              <button type="button" class="btn btn-default" style="width:62px;"><editable type="number" model="kettle.temp.diff">{{kettle.temp.diff}}</editable>&deg;{{settings.unit}}</button>
              <button type="button" class="btn btn-default" ng-click="changeValue(kettle,'diff',false)"><i class="fa fa-minus fa-lg"></i></button>
              <button type="button" class="btn btn-default" ng-click="changeValue(kettle,'diff',true)"><i class="fa fa-plus fa-lg"></i></button>
            </div>
            <div class="btn-group pull-right" role="group" ng-if="kettle.type=='grain'">
              <label class="adjust">Timers</label>
              <button type="button" class="btn btn-default" ng-click="removeTimers($event,kettle)" ng-show="kettle.timers.length"><i class="fa fa-trash fa-lg"></i></button>
              <button type="button" class="btn btn-default add-timer" ng-click="addTimer(kettle)"><img src="/assets/img/grain.svg" width="32"></button>
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span></button>
              <ul class="dropdown-menu scrollable-menu">
                <li ng-repeat="grain in grains">
                  <a href="#" ng-click="addTimer(kettle,{label:grain.name,min:60})">{{grain.name}}</a>
                </li>
              </ul>
            </div>
            <div class="btn-group pull-right" role="group" ng-if="kettle.type=='hop'">
              <label class="adjust">Timers</label>
              <button type="button" class="btn btn-default" ng-click="removeTimers($event,kettle)" ng-show="kettle.timers.length"><i class="fa fa-trash fa-lg"></i></button>
              <button type="button" class="btn btn-default add-timer" ng-click="addTimer(kettle)"><img src="/assets/img/hop.svg" width="32"></button>
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span></button>
              <ul class="dropdown-menu scrollable-menu">
                <li><a href="#" ng-click="addTimer(kettle,{label:'Whirlfloc',min:10})">Whirlfloc</a></li>
                <li ng-repeat="hop in hops">
                  <a href="#" ng-click="addTimer(kettle,{label:hop.name,min:30})">{{hop.name}}</a>
                </li>
              </ul>
            </div>
            <div class="btn-group pull-right" role="group" ng-if="kettle.type=='water'">
              <label class="adjust">Timers</label>
              <button type="button" class="btn btn-default" ng-click="removeTimers($event,kettle)" ng-show="kettle.timers.length"><i class="fa fa-trash fa-lg"></i></button>
              <button type="button" class="btn btn-default add-timer" ng-click="addTimer(kettle)"><img src="/assets/img/water.svg" width="32"></button>
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span></button>
              <ul class="dropdown-menu scrollable-menu">
                <li ng-repeat="water in water">
                  <a href="#" ng-click="addTimer(kettle,{label:water.name,min:10})">{{water.name}}</a>
                </li>
              </ul>
            </div>
        </div>
      </div>
      <div class="kettle-row timers" ng-if="!settings.shared">
        <div class="kettle-col">
          <ul>
            <li ng-repeat="timer in kettle.timers track by $index" ng-class="{'running':(timer.running && !timer.up), 'queue': timer.queue, 'finished': timer.up}">
            <label class="adjust"><editable model="timer.label"></editable> <sup ng-if="timer.queue" class="queue">in queue</sup></label>
            <label class="notes" ng-if="timer.notes"><editable model="timer.notes"></editable></label>
            <div class="input-group" role="group">
              <editable class="timer" ng-show="!timer.up" type="number" model="timer.min"></editable><span class="timer-secs" ng-if="!timer.up">: {{timer.sec}}</span>
              <span class="count-up" ng-show="timer.up" ng-click="timerStart(timer,kettle)">{{timer.up.min}}</span><span ng-if="timer.up" class="timer-secs-up" ng-click="timerStart(timer,kettle)">: {{timer.up.sec}}</span>
              <span class="input-group-btn">
                <button type="button" class="btn btn-default" ng-if="timer.min!==null" ng-click="timer.min=timer.min-1" ng-disabled="timer.up"><i class="fa fa-minus fa-lg"></i></button>
                <button type="button" class="btn btn-default" ng-if="timer.min!==null" ng-click="timer.min=timer.min+1" ng-disabled="timer.up"><i class="fa fa-plus fa-lg"></i></button>
                <button type="button" class="btn btn-default" ng-if="timer.min!==null" ng-click="timerStart(timer,kettle)" ng-disabled="timer.queue"><i class="fa fa-lg" ng-class="{'fa-stop-circle':timer.running||timer.up.running,'fa-play-circle':!timer.running&&!timer.queue&&!timer.up.running,'fa-clock-o':timer.queue}"></i></button>
                <button type="button" class="btn btn-default" ng-click="kettle.timers.splice($index, 1);"><i class="fa fa-trash fa-lg"></i></button>
              </span>
            </div>
            </li>
          </ul>
        </div>
      </div>

      <div class="kettle-row" ng-if="!settings.shared">
        <div class="kettle-col" style="text-align: center;">
          <i class="fa fa-3x" ng-class="{'fa-chevron-up':!showRemoveKettle,'fa-chevron-down':showRemoveKettle}" aria-hidden="true" ng-click="showRemoveKettle=!showRemoveKettle"></i>
          <button ng-show="showRemoveKettle" class="btn btn-danger" ng-click="showRemoveKettle=false;kettles.splice($index,1)">Remove Kettle</button>
        </div>
      </div>

    </div>

  </div>

</div>
