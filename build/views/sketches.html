<div class="modal fade" id="sketchesModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title"><img src="/assets/img/arduino.svg" width="45"> Sketches</h1>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body settings">
      <div id="sketches">
      <div class="card-body">
        <div class="pb-3">
          <div class="row new pb-3">
            <div class="col-lg-4 col-sm-6 pb-3">
              <label class="adjust">Sketch Info</label>
              <strong>Current Sketch Version:</strong> {{pkg.sketch_version}} <br/>
              <strong>Your Sketch Version:</strong> {{settings.sketches.version}}
            </div>
            <div class="col-lg-4 col-sm-6 pb-3">
              <label class="adjust">Required libraries</label>
              <p>
                <a href="https://www.brewbench.co/libs/DHTLib.zip">DHT Library</a> <br/>
                <a href="https://www.brewbench.co/libs/cactus_io_DS18B20.zip">DS18B20 Library</a>
              </p>
            </div>
            <div class="col-lg-4 col-sm-6 pb-3">
              <label class="adjust">Other Links</label>
              <a href="https://www.arduino.cc/en/Main/Software target="_blank"">Arduino IDE</a> <br/>
              <a href="https://grafana.com/dashboards?search=BrewBench" target="_blank">Grafana Dashboards</a>
            </div>
          </div>
        </div>
        <div class="pb-3">
          <h4>
            BrewBench Basic
          </h4>
          <div class="block-border">
            <div class="row new pb-3">
              <div class="col-10 pb-3">
                <p>This is a basic sketch that lets you connect to all of the supported sensors.  Use this to configure and test all kettles before uploading any the other sketches.</p>
              </div>
              <div class="col-2">
                <a class="btn btn-light float-right" href="/assets/arduino/BrewBenchYun/BrewBenchYun.ino" class="dropdown-item">Download Sketch</a>
              </div>
            </div>
          </div>
        </div>

          <div class="pb-3">
            <h4>
              <img src="/assets/img/brewbench-colors.png" width="35" style="margin-top: -5px;border-radius: 10px;">
              BrewBench Streams
              <sup class="badge badge-{{ getStatusClass(settings.streams.status) }} badge-pill">
                {{ settings.streams.status || 'Not Connected'}}
              </sup>
              <a href="https://app.brewbench.co" target="_blank" ng-if="settings.streams.status != 'Connected'">signup</a>
              <a href="https://app.brewbench.co/dashboard/{{ settings.streams.api_key }}" target="_blank" ng-if="settings.streams.status == 'Connected'">dashboard</a>
            </h4>
            <div class="block-border">
              <div class="row">
                <div class="col-10">
                  <p>
                    The Streams sketch will be dynamically created depending on what sensors are in use with your current configuration.  It will run in the background sending temperature data to your BrewBench Streams account for secure remote monitoring.
                    <br/>Working with BrewBench <span class="badge badge-pill badge-info">Auto</span> it will also trigger the heat / cool relays and notifications you have turned on.
                  </p>
                </div>
                <div class="col-2">
                  <a href="" class="btn btn-light float-right" ng-click="compileSketch('StreamsYun')" ng-disabled="settings.streams.status!='Connected'">Download Sketch</a>
                </div>
              </div>
              <div class="row pb-2">
                <div class="col-6">
                  <label class="adjust">Username</label>
                  <input class="form-control" type="text" ng-model="settings.streams.user" placeholder="Username">
                </div>
                <div class="col-6">
                  <label class="adjust">API Key</label>
                  <input class="form-control" type="text" ng-model="settings.streams.api_key" placeholder="API Key">
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                    <button class="btn btn-primary float-right" ng-click="streamsConnect()" ng-disabled="!settings.streams.user && !settings.streams.api_key">Connect</button>
              </div>
            </div>
          </div>

          <div class="pb-3">
            <h4>
              <img src="/assets/img/influxdb.png" width="35" style="margin-top: -5px;">
              BrewBench InfluxDB
              <sup class="badge badge-{{ getStatusClass(settings.influxdb.status) }} badge-pill">
                {{ settings.influxdb.status || 'Not Connected'}}
              </sup>
              <a href="#" ng-click="showInflux=!showInflux;">{{!showInflux ? 'show': 'hide'}}</a>
            </h4>
            <div class="block-border" ng-show="showInflux">
              <div class="row">
                <div class="col-10">
                  <p>
                    The InfluxDB sketch will be dynamically created depending on what sensors are in use with your current configuration.  It will run in the background sending temperature data to your InfluxDB time-series database.
                    <br/>Working with BrewBench <span class="badge badge-pill badge-info">Auto</span> it will also trigger the heat / cool relays and notifications you have turned on.
                  </p>
                </div>
                <div class="col-2">
                  <a href="" ng-click="compileSketch('InfluxDBYun')" class="btn btn-light float-right" ng-class="{'disabled':!settings.influxdb.connected}">Download Sketch</a>
                </div>
              </div>
              <div class="row">
                <div class="col-9">
                  <label class="adjust">Url</label>
                  <input id="influxdbUrl" class="form-control" type="text" ng-model="settings.influxdb.url" placeholder="http://InfluxDBUrl">
                </div>
                <div class="col-3">
                  <label class="adjust">Port</label>
                  <input class="form-control" style="width: 100%;" type="number" ng-model="settings.influxdb.port">
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <label class="adjust">Database</label>
                  <div class="input-group">
                    <div class="input-group-btn" ng-if="settings.influxdb.dbs && settings.influxdb.dbs.length">
                      <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">DBs</button>
                      <div class="dropdown-menu">
                        <a class="dropdown-item" href="" ng-click="settings.influxdb.db=''">Create a new database</a>
                        <div role="separator" class="dropdown-divider"></div>
                        <a ng-repeat="db in settings.influxdb.dbs" class="dropdown-item" href="" ng-click="settings.influxdb.db=db">{{db}}</a>
                      </div>
                    </div>
                    <input class="form-control" type="text" ng-model="settings.influxdb.db" placeholder="Database Name">
                    <span class="input-group-btn">
                      <button class="btn btn-primary" ng-click="createInfluxDB()" ng-disabled="!settings.influxdb.connected">Create</button>
                    </span>
                  </div>
                  <small ng-if="settings.influxdb.created" class="badge badge-success">Created</small>
                </div>
              </div>
              <div class="row pb-2">
                <div class="col-6">
                  <label class="adjust">Username</label>
                  <input id="influxdbUser" class="form-control" type="text" ng-model="settings.influxdb.user" placeholder="Username">
                </div>
                <div class="col-6">
                  <label class="adjust">Password</label>
                  <input id="influxdbPass" class="form-control" type="password" ng-model="settings.influxdb.pass" placeholder="Password">
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                    <button class="btn btn-primary float-right" ng-click="testInfluxDB()" ng-disabled="!settings.influxdb.url">Connect</button>
                </div>
              </div>
          </div>
        </div>
        <div class="pb-3">
          <h4>
            BrewBench <span class="badge badge-pill badge-info">Auto</span>
          </h4>
          <div class="block-border">
            <div class="row">
              <div class="col-10">
                <p>
                  The Auto sketch will be dynamically created depending on what sensors are in use with your current configuration.  It will run in the background and trigger the heat / cool relays and notifications you have turned on below.
                </p>
              </div>
              <div class="col-2">
                <a href="" ng-click="compileSketch('AutoYun')" class="btn btn-light float-right"  ng-class="{'disabled': !hasSketches()}">Download Sketch</a>
              </div>
            </div>
              <table class="table table-striped table-responsive">
                <thead class="thead-inverse">
                  <tr>
                    <th>Name</th>
                    <th>Heat <span class="badge badge-pill badge-info">Auto</span></th>
                    <th>Cool <span class="badge badge-pill badge-info">Auto</span></th>
                    <th>Notify</th>
                    <th>Current</th>
                    <th>Target</th>
                    <th>Diff</th>
                    <th>Adjustment</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="kettle in kettles track by $index">
                    <td>
                      <img ng-if="kettle.type != 'air'" class="type" ng-src="/assets/img/{{kettle.type}}.svg" width="30" height="30"/>
                      <i ng-if="kettle.type == 'air'" class="fa fa-thermometer-quarter fa-2x type" height="30"></i>
                      &nbsp;
                      <strong>{{kettle.key}}</strong><br/>
                      {{kettle.temp.pin}} {{kettle.temp.type}}<br/>
                      <img src="assets/img/arduino.svg" width="15">&nbsp;{{ kettle.arduino.url }}
                    </td>
                    <td>
                      <span ng-if="kettle.heater && kettle.heater.pin.indexOf('TP-')===0">
                        <i>Not Supported</i> <br/>
                        {{pinDisplay(kettle.heater.pin)}}
                      </span>
                      <span ng-if="!kettle.heater">
                        <i>Not Available</i> <br/>
                      </span>
                      <ul class="tg-list" ng-if="kettle.heater && kettle.heater.pin.indexOf('TP-')===-1">
                        <li class="tg-list-item">
                          <span>{{pinDisplay(kettle.heater.pin)}}</span>
                          <input class="tgl tgl-ios" id="triggerHeater{{$index}}" type="checkbox"
                            ng-checked="kettle.heater.sketch"
                            ng-click="kettle.heater.sketch = !kettle.heater.sketch;"/>
                          <label class="tgl-btn" for="triggerHeater{{$index}}"></label>
                        </li>
                      </ul>
                    </td>
                    <td>
                      <span ng-if="kettle.cooler && kettle.cooler.pin.indexOf('TP-')===0">
                        <i>Not Supported</i> <br/>
                        {{pinDisplay(kettle.cooler.pin)}}
                      </span>
                      <span ng-if="!kettle.cooler">
                        <i>Not Available</i> <br/>
                      </span>
                      <ul class="tg-list" ng-if="kettle.cooler && kettle.cooler.pin.indexOf('TP-')===-1">
                        <li class="tg-list-item">
                          <span>{{pinDisplay(kettle.cooler.pin)}}</span>
                          <input class="tgl tgl-ios" id="triggerCooler{{$index}}" type="checkbox"
                            ng-checked="kettle.cooler.sketch"
                            ng-click="kettle.cooler.sketch = !kettle.cooler.sketch;"/>
                          <label class="tgl-btn" for="triggerCooler{{$index}}"></label>
                        </li>
                      </ul>
                    </td>
                    <td>
                      <ul class="tg-list">
                        <li class="tg-list-item">
                          <span>Slack</span>
                          <input class="tgl tgl-ios" id="slack{{$index}}" type="checkbox" ng-disabled="!settings.notifications.slack" ng-checked="kettle.notify.slack" ng-click="kettle.notify.slack = !kettle.notify.slack"/>
                          <label class="tgl-btn" for="slack{{$index}}"></label>
                        </li>
                        <li class="tg-list-item">
                          <span>Dweet</span>
                          <input class="tgl tgl-ios" id="dweet{{$index}}" type="checkbox" ng-checked="kettle.notify.dweet" ng-click="kettle.notify.dweet = !kettle.notify.dweet"/>
                          <label class="tgl-btn" for="dweet{{$index}}"></label>
                        </li>
                      </ul>
                    </td>
                    <td>{{kettle.temp.current | number:2}}&deg;{{settings.unit}}</td>
                    <td>{{kettle.temp.target}}&deg;{{settings.unit}}</td>
                    <td>{{kettle.temp.diff}}&deg;{{settings.unit}}</td>
                    <td>{{kettle.temp.adjust}}&deg;{{settings.unit}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="row new">
            <div class="col-lg-1"></div>
            <div class="col-lg-10">
              <p>
                <span class="badge badge-pill badge-info">Auto</span> <strong>Sketches are still in beta</strong>.  Please test your heat and cool pins before installing the sketch as relay's will automatically be triggered if the temperature raises or falls.
                <br><br>
                Arduino Yun has a limited amount of memory and will be unstable if the sketch exceeds 21570 bytes (75%) of program storage space and or Global variables use more than 1229 bytes (48%) of dynamic memory.  There is logic to include only libraries that are needed.
                <br><br>
                Slack Webhook URL can be added in settings and <a href="https://dweet.io/get/dweets/for/brewbench" target="_blank">Dweet</a> is interesting...
              </p>
            </div>
            <div class="col-lg-1"></div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
</div>
</div>
